version: 1.1.{build}


dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{$assembly_version}'
  package_version: '{$assembly_version}'
  assembly_version: '{$assembly_version}'
  file_version: '{$assembly_version}'
  informational_version: '{$assembly_version}'

cache:
  - '%APPDATA%\npm-cache'

install:
  - npm install -g semantic-release@15
  - ps: |
      semantic-release --dry-run |  %{ 
        $fields = -split $_;
        if ($fields[0] -eq "#") {
          Set-Variable -Name "Version" -Value $fields[1]
        }
      }

      if ($Version -eq $null)
      {
        $Version = "0.0.$build"
      }
      echo "Version is $Version version is $version build is $build"

      Set-AppveyorBuildVariable -Name "assembly_version" -Value "$Version"
      Set-AppveyorBuildVariable -Name "assembly_file_version" -Value "$Version"
      Set-AppveyorBuildVariable -Name "assembly_informational_version" -Value "$Version"

build_script:
  - cmd: dotnet publish -f netcoreapp2.1

test_script: 
  - cmd: dotnet test -f netcoreapp2.1

